\documentclass[10pt,a4paper]{article}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{ngrammar}
\usepackage{ndisplay}
\usepackage{comment}
\usepackage[inference]{semantic}
\usepackage{color}
\usepackage{textcomp}
\newcommand\highlight[2]{{\setlength\fboxsep{1pt}\colorbox{#1}{#2}}}
\def\NV{\highlight{colorNV}}
\definecolor{colorNV}{rgb}{1,0.8,1}

\usepackage{liquidHaskell}

\usepackage{amsthm}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}
\newtheorem*{proofIdea}{ProofIdea}

\newcommand\mhide[1]{\NV{hiding something}\\}
\newcommand\rhide[1]{#1}
\newcommand\thide[1]{}
\newcommand\rulename[1]{\textsc{#1}}
\newcommand\mlTy[1]{\ensuremath{#1}}
\newcommand\hastype[3]{\ensuremath{#1 \vdash #2 : #3}}


\begin{document}
\NV{missing:}\\
\NV{* Proofs for Lemmata}\\
\NV{* expr let where unification takes place}\\
\NV{* expr case}\\
\NV{* type classes?}\\

\include{grammar}
\section*{Operational Semantics}
\hfill\fbox{\eval{e}{e}}

$$
\inference{
	\eval{e_1}{e_1'}
}{
	\eval{\eapp{e_1}{e_2}}{\eapp{e_1'}{e_2}}
}[\rulename{S-PAppL}]
$$

$$
\inference{
	\eval{e_2}{e_2'}
}{
	\eval{\eapp{v}{e_2}}{\eapp{v}{e_2'}}
}[\rulename{S-PAppR}]
$$

$$
\inference{
	\eval{e}{e'}
}{
	\eval{\etapp{e}{\tau}}{\etapp{e'}{\tau}}
}[\rulename{S-PType-App}]
$$
$$
\inference{
	\eval{e}{e'}
}{
	\eval{\epapp{e}}{\epapp{e'}}
}[\rulename{S-PPred-App}]
$$

$$
\inference{
}{
	\eval{\eapp{\efun{x}{e}}{v}}{e\sub{x}{v}}
}[\rulename{S-EApp}]
$$

$$
\inference{
}{
	\eval{\eapp{c}{v}}{[|c|](v)}
}[\rulename{S-EApp-Con}]
$$

$$
\inference{
}{
	\eval{\epapp{(\epabs{p}{\tau}{v})}}{v}
}[\rulename{S-EPred-App}]
$$

\NV{are the following two rules valid?}
$$
\inference{
}{
	\eval{\epapp{c}}{\epapp{[|c|]}}
}[\rulename{S-EPApp-Con}]
$$

$$
\inference{
}{
	\eval{\etapp{c}{\tau}}{\etapp{[|c|]}{\tau}}
}[\rulename{S-ETApp-Con}]
$$

$$
\inference{
}{
	\eval{\etapp{(\etabs{\alpha}{v})}{\tau}}{v\sub{\alpha}{\tau}}
}[\rulename{S-EType-App}]
$$


%\subsection*{Typing}
\include{typing}
%\subsection*{WF sub}
\hfill\fbox{\isWellFormed{\Gamma}{\rho}}

$$
\inference{
}{
	\isWellFormed{\emptyset}{\emptyset}
}[\wsEmp]
$$

$$
\inference{
	\isWellFormed{\Gamma}{\rho} && \hastypeEmp{v}{\rho S}
}{
	\isWellFormed{\Gamma; x:S}{\rho ; \sub{x}{v}}
}[\wsExt]
$$



\begin{comment}
$$
\inference{
	\isWellFormed{\Gamma}{\rho} && \evalstar{\rho e}{true}
}{
	\isWellFormed{\Gamma; e}{\rho}
}[\wsGxt]
$$
\end{comment}


%\subsection*{WF type sub}

\NV{define type sub, \sch{T} = $\tau$, sub $\tau$ on exprs and T on types}\\

\hfill\fbox{\isWellFormed{\Gamma}{\theta}}

$$
\inference{
}{
	\isWellFormed{\emptyset}{\emptyset}
}[\wstEmp]
$$

$$
\inference{
	\isWellFormed{\Gamma}{\theta} && \isWellFormed{\emptyset}{\theta S}
}{
	\isWellFormed{\Gamma}{\theta;\sub{a}{S}}
}[\wstExt]
$$


\section*{Proves}

\begin{definition}[Constants]
\label{DefConstants}
Each constant $c$ has type \tc{c}, such that
\begin{enumerate}
\item \hastypeEmp{c}{\tc{c}}
\item if $\tc{c} \equiv \tfun{x}{T_x}{T}$
	  then for all values $v \in T_x$, 
	  $[|c|](v)$ is defined and 
	  \hastypeEmp{[|c|](v)}{T\sub{x}{v}}.
\item if $\tc{c} \equiv \ttabs{\alpha}{S}$
	  then for all types $\tau$, 
	  if for some $T$, then 
	  $\sch{T} = \tau$ and \isWellFormed{\emptyset}{T}, 
	  $\etapp{[|c|]}{\tau}$ is defined and 
	  \hastypeEmp{\etapp{[|c|]}{\tau}}{S\sub{\alpha}{T}}.
\item if $\tc{c} \equiv \tpabs{p}{\tau}{S}$
	  then for all values $v$, 
	  if \hastypeEmp{v}{\tau \rightarrow \tbbool},
	  $\epapp{[|c|]}$ is defined and 
	  \hastypeEmp{\epapp{[|c|]}}{S\sub{p}{v}}.
%\item If \tc{c} is \tref{B}{e} then $e \equiv \vref = c $
\end{enumerate}
\end{definition}

\begin{lemma}
\label{LemEvalSub}
If \eval{e}{e'} 
and \hastypeEmp{e}{S_e}
and \hastypeEmp{e'}{S_e}
then \isSub{\Gamma}{S\sub{x}{e'}}{S\sub{x}{e}}
\end{lemma}
\begin{proofIdea}
$[| \star|]$ is defined to preserve operational semantics
\end{proofIdea}


\begin{lemma}[Value Substitution]
\label{LemValueSub}
If \isWellFormed{\Gamma}{\rho} 
then if \hastype{\Gamma; \Gamma'}{e}{S}
then \hastype{\rho\Gamma'}{\rho e}{\rho S}
\end{lemma}
\begin{proofIdea}
Pat-Ming Lemma 10
\end{proofIdea}

\begin{lemma}[Type Substitution]
\label{LemTypeSub}
If \isWellFormed{\Gamma}{\theta} 
then if \hastype{\Gamma; \Gamma'}{e}{S}
then \hastype{\rho\Gamma'}{\theta e}{\theta S}
\end{lemma}
\begin{proofIdea}
???
\end{proofIdea}


\include{preservation}
\include{progress}

\include{soundness}

\end{document}