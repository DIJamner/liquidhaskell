
\begin{theorem}[Progress]
	If \hastypeEmp{e}{S} and $e$ is not a value, 
	then there exists an $e'$ such that \eval{e}{e'}.
\end{theorem}
	
\begin{proof}
By induction on the typing derivation \hastypeEmp{e}{S}.
We split cases on the rule used on the top of the derivation.

\begin{itemize}
	\item\tsub 

\begin{align*}
\hastypeEmp{e}{S}
\end{align*}

By inversion, there exists an $S'$ such that 
\begin{align}
\hastypeEmp{e}{S'} 	\label{prsa}\\
\isSubEmp{S'}{S}		\label{prsb}
\end{align}

If $e$ is a value, it is trivial, as the assumptions of the theorem are not true.
Otherwise, by IH and \ref{prsa}, there exists an $e'$, such that \eval{e}{e'}.


\item	\rulename{T-Var-Base}, 
		\rulename{T-Var}, 
		\tcon, 
		\rulename{T-Fun}
		\rulename{T-PGen},
		\tgen\
cases are trivial, since $e$ is a value.


\item \rulename{T-App}
\begin{align*}
\hastypeEmp{\eapp{e_1}{e_2}}{S} 
\end{align*}
By inversion, there exist $x$ and $T_x$ such that 
\begin{align}
\hastypeEmp{e_1}{\tfun{x}{T_x}{T}} 		\label{prappa}\\
\hastypeEmp{e_2}{T_x}					\label{prappb}\\
S \equiv T\sub{x}{e_1}					\label{prappc}
\end{align}

\begin{itemize}
	\item $e_1$ is not a value.
	From IH and \ref{prappa}
	there exits $e_1'$ so that \eval{e_1}{e_1'}, so $e' \equiv \eapp{e_1'}{e_2}$.

	\item $e_1$ is a value, $e_1 \equiv v$
	\begin{itemize}
		\item $e_2$ is not a value.
		From IH and \ref{prappb} these exits $e_2'$ so that \eval{e_2}{e_2'}, 
		so $e' \equiv \eapp{v}{e_2'}$
		
		\item $e_2$ is a value, so $e_2 \equiv v_2$.
		Since $e_1$ is a value, it can not be variable, as $e_1$ is closed,
		and can not be of the form $\epabs{p}{\tau}{e'}$ nor $\etabs{\alpha}{e'}$,
		as these values can not have the desired type. 
		\begin{itemize}
			\item $e_1 \equiv \efun{x}{e_{11}}$, so $e' \equiv e_{11}\sub{x}{v_2}$.
			\item $e_1 \equiv c$. 
			By \ref{prappa}, $\tc{c} = \tfun{x}{T_x}{T}$
			and by \ref{prappa} \hastypeEmp{v_2}{T_x}, 
            so, by Definition \ref{DefConstants}, $[|c|](v)$ is defined.			
			So, $e' \equiv [|c|](v)$.
		\end{itemize}
	\end{itemize}
\end{itemize}


\item \tinst\ There exist $e_1, S_1, \alpha$ and $\tau$ such that
\begin{align*}
e \equiv \etapp{e_1}{\tau} && S \equiv S_1\sub{\alpha}{T}
\end{align*}

By inversion, we have

\begin{align}
	\hastypeEmp{e_1}{\ttabs{\alpha}{S_1}} \label{pria}\\
	\sch{T} = \tau \label{prib}\\
	\isWellFormed{\emptyset}{T} \label{pric}
\end{align} 

	\begin{itemize}
	\item If $e_1$ is not a value, 
	there exists $e_1'$, such that \eval{e_1}{e_1'}, 
	and $e' \equiv \etapp{e_1'}{\tau}$.

	\item If $e_1$ is a value. From \ref{pria} there are two cases:

		\begin{itemize}
		\item $e_1 \equiv \etabs{\alpha}{v_{1}}$, so $e' \equiv v_1\sub{\alpha}{\tau}$.
		\item $e_1 \equiv c$.
		From \ref{prib}, $\tc{c} = \ttabs{\alpha}{S_1}$.
		Which, by \ref{prib}, \ref{pric} and Definition \ref{DefConstants} gives that 
		\etapp{[|c|]}{\tau} is defined. 
		So, $e' \equiv \etapp{[|c|]}{\tau}$.
		\end{itemize}
 	\end{itemize}


\item \tpinst\ There exist $e_1, S_1, p$ and $v$ such that
\begin{align*}
e \equiv \epapp{e_1} && S \equiv S_1\sub{p}{v}
\end{align*}

By inversion, we have

\begin{align}
\hastypeEmp{e_1}{\tpabs{p}{\tau}{S_1}} \label{prpa}\\
\hastypeEmp{v}{T} \label{prpb}\\
\sch{T} = \tau \rightarrow \tbbool \label{prpc}\\
\isWellFormed{\emptyset}{T} \label{prpd}
\end{align} 

	\begin{itemize}
	\item If $e_1$ is not a value, 
	there exists $e_1'$, such that \eval{e_1}{e_1'}, 
	so, $e' \equiv \epapp{e_1'}$.

	\item If $e_1$ is a value,
	 From \ref{prpa} there are two cases:

		\begin{itemize}
		\item $e_1 \equiv \epabs{p}{\tau}{v_{1}}$, so $e' \equiv v_1$.
		\item $e_1 \equiv c$.
		From \ref{prpa}, $\tc{c} = \tpabs{p}{\tau}{S_1}$, 
		which, by \ref{prpb} - \ref{prpd} and Definition \ref{DefConstants},
		gives that \epapp{[|c|]} is defined.
		So, $e' \equiv \epapp{[|c|]}$
		\end{itemize}
	\end{itemize}
\end{itemize}
\end{proof}

