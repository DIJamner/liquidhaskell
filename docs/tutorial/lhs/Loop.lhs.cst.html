<h2 id="higher-order-specifications">Higher Order Specifications</h2>
<pre><span class=hs-linenum>8: </span><span class='hs-keyword'>module</span> <span class='hs-conid'>Loop</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum>9: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>!!</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>length</span><span class='hs-layout'>)</span>
<span class=hs-linenum>10: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>SimpleRefinements</span>
</pre>


<h2 id="higher-order-specifications-1">Higher Order Specifications</h2>
<p>Consider a <code>loop</code> function: <br></p>
<pre><span class=hs-linenum>20: </span><span class='hs-definition'>loop</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>21: </span><a class=annot href="#"><span class=annottext>forall a.
lo#a1f7:{VV#47 : (GHC.Types.Int) | k_48}
-&gt; hi#a1f8:{VV#50 : (GHC.Types.Int) | k_51}
-&gt; base#a1f9:{VV#53 : a | k_54}
-&gt; f#a1fa:(lq_tmp_x56:{VV#57 : (GHC.Types.Int) | k_58}
           -&gt; lq_tmp_x59:{VV#60 : a | k_61} -&gt; {VV#62 : a | k_63})
-&gt; {VV#65 : a | k_66}</span><span class='hs-definition'>loop</span></a> <a class=annot href="#"><span class=annottext>{VV#47 : (GHC.Types.Int) | k_48}</span><span class='hs-varid'>lo</span></a> <a class=annot href="#"><span class=annottext>{VV#50 : (GHC.Types.Int) | k_51}</span><span class='hs-varid'>hi</span></a> <a class=annot href="#"><span class=annottext>{VV#53 : a | k_54}</span><span class='hs-varid'>base</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x56:{VV#57 : (GHC.Types.Int) | k_58}
-&gt; lq_tmp_x59:{VV#60 : a | k_61} -&gt; {VV#62 : a | k_63}</span><span class='hs-varid'>f</span></a>        <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x87:{VV#88 : (GHC.Types.Int) | k_89}
-&gt; lq_tmp_x90:{VV#91 : a | k_92} -&gt; {VV#93 : a | k_94}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{VV#47 : (GHC.Types.Int) | k_48 &amp;&amp; (VV#47 == lo#a1f7)}</span><span class='hs-varid'>lo</span></a> <a class=annot href="#"><span class=annottext>{VV#53 : a | k_54 &amp;&amp; (VV#53 == base#a1f9)}</span><span class='hs-varid'>base</span></a>
<span class=hs-linenum>22: </span>  <span class='hs-keyword'>where</span> 
<span class=hs-linenum>23: </span>    <a class=annot href="#"><span class=annottext>forall a.
lo#X0:{VV#67 : (GHC.Types.Int) | k_68}
-&gt; hi#X1:{VV#69 : (GHC.Types.Int) | k_70}
-&gt; base#X2:{VV#71 : a | k_72}
-&gt; f#X3:(lq_tmp_x73:{VV#74 : (GHC.Types.Int) | k_75}
         -&gt; lq_tmp_x76:{VV#77 : a | k_78} -&gt; {VV#79 : a | k_80})
-&gt; i#a1fc:{VV#81 : (GHC.Types.Int) | k_82}
-&gt; acc#a1fd:{VV#83 : a | k_84}
-&gt; {VV#85 : a | k_86}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{VV#81 : (GHC.Types.Int) | k_82[lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2][f#X3:=f#X3]}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{VV : a | k_84[VV#83:=VV][lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2][f#X3:=f#X3][i#a1fc:=i#a1fc]}</span><span class='hs-varid'>acc</span></a> <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>{VV#81 : (GHC.Types.Int) | k_82[lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2][f#X3:=f#X3] &amp;&amp; (VV#81 == i#a1fc)}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>x:{VV#103 : (GHC.Types.Int) | k_104[_LIQUID_dummy:=fix##36#fOrdInt#35#r10i]}
-&gt; y:{VV#103 : (GHC.Types.Int) | k_104[_LIQUID_dummy:=fix##36#fOrdInt#35#r10i]}
-&gt; {VV : (GHC.Types.Bool) | (((Prop VV)) &lt;=&gt; (x &lt; y))}</span><span class='hs-varop'>&lt;</span></a> <a class=annot href="#"><span class=annottext>{VV#69 : (GHC.Types.Int) | k_70[lo#X0:=lo#X0] &amp;&amp; (VV#69 == hi#X1)}</span><span class='hs-varid'>hi</span></a>    <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall a.
lo#X0:{VV#67 : (GHC.Types.Int) | k_68}
-&gt; hi#X1:{VV#69 : (GHC.Types.Int) | k_70}
-&gt; base#X2:{VV#71 : a | k_72}
-&gt; f#X3:(lq_tmp_x73:{VV#74 : (GHC.Types.Int) | k_75}
         -&gt; lq_tmp_x76:{VV#77 : a | k_78} -&gt; {VV#79 : a | k_80})
-&gt; i#a1fc:{VV#81 : (GHC.Types.Int) | k_82}
-&gt; acc#a1fd:{VV#83 : a | k_84}
-&gt; {VV#85 : a | k_86}</span><span class='hs-varid'>go</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV#81 : (GHC.Types.Int) | k_82[lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2][f#X3:=f#X3] &amp;&amp; (VV#81 == i#a1fc)}</span><span class='hs-varid'>i</span></a><a class=annot href="#"><span class=annottext>x:(GHC.Types.Int)
-&gt; y:(GHC.Types.Int) -&gt; {VV : (GHC.Types.Int) | (VV == (x + y))}</span><span class='hs-varop'>+</span></a><a class=annot href="#"><span class=annottext>{VV#116 : (GHC.Types.Int) | (VV#116 == (1  :  int)) &amp;&amp; (VV#116 == lq_anf__d1gm)}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x73:{VV#74 : (GHC.Types.Int) | k_75[lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2]}
-&gt; lq_tmp_x76:{VV : a | k_78[VV#77:=VV][lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2]}
-&gt; {VV : a | k_80[VV#79:=VV][lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2]}</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{VV#81 : (GHC.Types.Int) | k_82[lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2][f#X3:=f#X3] &amp;&amp; (VV#81 == i#a1fc)}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{VV : a | k_84[VV#83:=VV][lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2][f#X3:=f#X3][i#a1fc:=i#a1fc] &amp;&amp; (VV == acc#a1fd)}</span><span class='hs-varid'>acc</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>24: </span>             <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : a | k_84[VV#83:=VV][lo#X0:=lo#X0][hi#X1:=hi#X1][base#X2:=base#X2][f#X3:=f#X3][i#a1fc:=i#a1fc] &amp;&amp; (VV == acc#a1fd)}</span><span class='hs-varid'>acc</span></a>
</pre>

<p><br></p>
<p>LiquidHaskell <strong>infers</strong></p>
<ul>
<li><code>f</code> called with <code>lo &lt;= i &lt; hi</code></li>
</ul>
<h2 id="higher-order-specifications-2">Higher Order Specifications</h2>
<p>Lets use <code>(!!)</code> to write a function that sums an <code>Int</code> list</p>
<pre><span class=hs-linenum>40: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>listSum</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>L</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>41: </span><span class='hs-definition'>listSum</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>L</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>42: </span><a class=annot href="#"><span class=annottext>lq_tmp_db0:(SimpleRefinements.L (GHC.Types.Int)) -&gt; (GHC.Types.Int)</span><span class='hs-definition'>listSum</span></a> <a class=annot href="#"><span class=annottext>(SimpleRefinements.L (GHC.Types.Int))</span><span class='hs-varid'>xs</span></a>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lo#a1f7:{VV#47 : (GHC.Types.Int) | k_48}
-&gt; hi#a1f8:{VV#50 : (GHC.Types.Int) | k_51}
-&gt; base#a1f9:{VV#143 : (GHC.Types.Int) | k_144 &amp;&amp; k_54[VV#53:=VV#143]}
-&gt; f#a1fa:(lq_tmp_x56:{VV#57 : (GHC.Types.Int) | k_58}
           -&gt; lq_tmp_x59:{VV#143 : (GHC.Types.Int) | k_144 &amp;&amp; k_61[VV#60:=VV#143]}
           -&gt; {VV#143 : (GHC.Types.Int) | k_144 &amp;&amp; k_63[VV#62:=VV#143]})
-&gt; {VV#143 : (GHC.Types.Int) | k_144 &amp;&amp; k_66[VV#65:=VV#143]}</span><span class='hs-varid'>loop</span></a> <a class=annot href="#"><span class=annottext>{VV#141 : (GHC.Types.Int) | (VV#141 == (0  :  int)) &amp;&amp; (VV#141 == lq_anf__d1gq)}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>{VV#128 : (GHC.Types.Int) | (VV#128 == (llen xs#a1fe)) &amp;&amp; (VV#128 == n#a1fg)}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{VV#142 : (GHC.Types.Int) | (VV#142 == (0  :  int)) &amp;&amp; (VV#142 == lq_anf__d1gr)}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>i#a1fh:{VV#129 : (GHC.Types.Int) | k_130}
-&gt; acc#a1fi:{VV#132 : (GHC.Types.Int) | k_133}
-&gt; {VV#135 : (GHC.Types.Int) | k_136}</span><span class='hs-varid'>body</span></a> 
<span class=hs-linenum>43: </span>  <span class='hs-keyword'>where</span> 
<span class=hs-linenum>44: </span>    <a class=annot href="#"><span class=annottext>i#a1fh:{VV#129 : (GHC.Types.Int) | k_130}
-&gt; acc#a1fi:{VV#132 : (GHC.Types.Int) | k_133}
-&gt; {VV#135 : (GHC.Types.Int) | k_136}</span><span class='hs-varid'>body</span></a>    <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#129 : (GHC.Types.Int) | k_130}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{VV#132 : (GHC.Types.Int) | k_133}</span><span class='hs-varid'>acc</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{VV#132 : (GHC.Types.Int) | k_133 &amp;&amp; (VV#132 == acc#a1fi)}</span><span class='hs-varid'>acc</span></a> <a class=annot href="#"><span class=annottext>x:(GHC.Types.Int)
-&gt; y:(GHC.Types.Int) -&gt; {VV : (GHC.Types.Int) | (VV == (x + y))}</span><span class='hs-varop'>+</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV#125 : (SimpleRefinements.L (GHC.Types.Int)) | (VV#125 == xs#a1fe)}</span><span class='hs-varid'>xs</span></a> <a class=annot href="#"><span class=annottext>ls:(SimpleRefinements.L {VV#137 : (GHC.Types.Int) | k_138})
-&gt; lq_tmp_db3:{VV : (GHC.Types.Int) | (VV &gt;= 0) &amp;&amp; true}
-&gt; {VV#137 : (GHC.Types.Int) | k_138}</span><span class='hs-varop'>!!</span></a> <a class=annot href="#"><span class=annottext>{VV#129 : (GHC.Types.Int) | k_130 &amp;&amp; (VV#129 == i#a1fh)}</span><span class='hs-varid'>i</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>45: </span>    <a class=annot href="#"><span class=annottext>{VV : (GHC.Types.Int) | (VV == (llen xs#a1fe))}</span><span class='hs-varid'>n</span></a>       <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>xs:(SimpleRefinements.L {VV#126 : (GHC.Types.Int) | k_127})
-&gt; {VV : (GHC.Types.Int) | (VV == (llen xs))}</span><span class='hs-varid'>length</span></a> <a class=annot href="#"><span class=annottext>{VV#125 : (SimpleRefinements.L (GHC.Types.Int)) | (VV#125 == xs#a1fe)}</span><span class='hs-varid'>xs</span></a>
</pre>

<p>By <strong>function subtyping</strong> LiquidHaskell <strong>infers</strong></p>
<ul>
<li><code>body</code> called with <code>0 &lt;= i &lt; llen xs</code></li>
<li>hence, indexing safe.</li>
</ul>
<p>Let's change the <code>0</code> to <code>1</code> and see what happens!</p>
<h2 id="higher-order-specifications-3">Higher Order Specifications</h2>
<p>We can give this function a better type:</p>
<pre><span class=hs-linenum>61: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>listNatSum</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>L</span> <span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nat</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>62: </span><span class='hs-definition'>listNatSum</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>L</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>63: </span><a class=annot href="#"><span class=annottext>lq_tmp_db1:(SimpleRefinements.L {VV : (GHC.Types.Int) | (VV &gt;= 0)})
-&gt; {VV : (GHC.Types.Int) | (VV &gt;= 0)}</span><span class='hs-definition'>listNatSum</span></a> <a class=annot href="#"><span class=annottext>(SimpleRefinements.L {VV : (GHC.Types.Int) | (VV &gt;= 0)})</span><span class='hs-varid'>xs</span></a>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lo#a1f7:{VV#47 : (GHC.Types.Int) | k_48}
-&gt; hi#a1f8:{VV#50 : (GHC.Types.Int) | k_51}
-&gt; base#a1f9:{VV#163 : (GHC.Types.Int) | k_164 &amp;&amp; k_54[VV#53:=VV#163]}
-&gt; f#a1fa:(lq_tmp_x56:{VV#57 : (GHC.Types.Int) | k_58}
           -&gt; lq_tmp_x59:{VV#163 : (GHC.Types.Int) | k_164 &amp;&amp; k_61[VV#60:=VV#163]}
           -&gt; {VV#163 : (GHC.Types.Int) | k_164 &amp;&amp; k_63[VV#62:=VV#163]})
-&gt; {VV#163 : (GHC.Types.Int) | k_164 &amp;&amp; k_66[VV#65:=VV#163]}</span><span class='hs-varid'>loop</span></a> <a class=annot href="#"><span class=annottext>{VV#161 : (GHC.Types.Int) | (VV#161 == (0  :  int)) &amp;&amp; (VV#161 == lq_anf__d1gt)}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>{VV#148 : (GHC.Types.Int) | (VV#148 == (llen xs#a1fj)) &amp;&amp; (VV#148 == n#a1fl)}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{VV#162 : (GHC.Types.Int) | (VV#162 == (0  :  int)) &amp;&amp; (VV#162 == lq_anf__d1gu)}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>i#a1fm:{VV#149 : (GHC.Types.Int) | k_150}
-&gt; acc#a1fn:{VV#152 : (GHC.Types.Int) | k_153}
-&gt; {VV#155 : (GHC.Types.Int) | k_156}</span><span class='hs-varid'>body</span></a> 
<span class=hs-linenum>64: </span>  <span class='hs-keyword'>where</span> 
<span class=hs-linenum>65: </span>    <a class=annot href="#"><span class=annottext>i#a1fm:{VV#149 : (GHC.Types.Int) | k_150}
-&gt; acc#a1fn:{VV#152 : (GHC.Types.Int) | k_153}
-&gt; {VV#155 : (GHC.Types.Int) | k_156}</span><span class='hs-varid'>body</span></a>       <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#149 : (GHC.Types.Int) | k_150}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{VV#152 : (GHC.Types.Int) | k_153}</span><span class='hs-varid'>acc</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{VV#152 : (GHC.Types.Int) | k_153 &amp;&amp; (VV#152 == acc#a1fn)}</span><span class='hs-varid'>acc</span></a> <a class=annot href="#"><span class=annottext>x:(GHC.Types.Int)
-&gt; y:(GHC.Types.Int) -&gt; {VV : (GHC.Types.Int) | (VV == (x + y))}</span><span class='hs-varop'>+</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV#145 : (SimpleRefinements.L {VV : (GHC.Types.Int) | (VV &gt;= 0)}) | (VV#145 == xs#a1fj)}</span><span class='hs-varid'>xs</span></a> <a class=annot href="#"><span class=annottext>ls:(SimpleRefinements.L {VV#157 : (GHC.Types.Int) | k_158})
-&gt; lq_tmp_db3:{VV : (GHC.Types.Int) | (VV &gt;= 0) &amp;&amp; true}
-&gt; {VV#157 : (GHC.Types.Int) | k_158}</span><span class='hs-varop'>!!</span></a> <a class=annot href="#"><span class=annottext>{VV#149 : (GHC.Types.Int) | k_150 &amp;&amp; (VV#149 == i#a1fm)}</span><span class='hs-varid'>i</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>66: </span>    <a class=annot href="#"><span class=annottext>{VV : (GHC.Types.Int) | (VV == (llen xs#a1fj))}</span><span class='hs-varid'>n</span></a>          <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>xs:(SimpleRefinements.L {VV#146 : (GHC.Types.Int) | k_147})
-&gt; {VV : (GHC.Types.Int) | (VV == (llen xs))}</span><span class='hs-varid'>length</span></a> <a class=annot href="#"><span class=annottext>{VV#145 : (SimpleRefinements.L {VV : (GHC.Types.Int) | (VV &gt;= 0)}) | (VV#145 == xs#a1fj)}</span><span class='hs-varid'>xs</span></a>
</pre>

<p>To verify this type, note: <code>(+) :: Nat -&gt; Nat -&gt; Nat</code></p>
<p>LiquidHaskell <strong>instantiates</strong> <code>a</code> in <code>loop</code> with <code>Nat</code></p>
<ul>
<li><code>loop :: Int -&gt; Int -&gt; Nat -&gt; (Int -&gt; Nat -&gt; Nat) -&gt; Nat</code></li>
</ul>
<p>Yielding the output.</p>
<h2 id="higher-order-specifications-4">Higher Order Specifications</h2>
<p>By the same analysis, LiquidHaskell verifies that <br></p>
<pre><span class=hs-linenum>83: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>listEvenSum</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>L</span> <span class='hs-conid'>Even</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Even</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>84: </span><span class='hs-definition'>listEvenSum</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>L</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>85: </span><a class=annot href="#"><span class=annottext>lq_tmp_db2:(SimpleRefinements.L {VV : (GHC.Types.Int) | ((VV mod 2) == 0)})
-&gt; {VV : (GHC.Types.Int) | ((VV mod 2) == 0)}</span><span class='hs-definition'>listEvenSum</span></a> <a class=annot href="#"><span class=annottext>(SimpleRefinements.L {VV : (GHC.Types.Int) | ((VV mod 2) == 0)})</span><span class='hs-varid'>xs</span></a>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lo#a1f7:{VV#47 : (GHC.Types.Int) | k_48}
-&gt; hi#a1f8:{VV#50 : (GHC.Types.Int) | k_51}
-&gt; base#a1f9:{VV#183 : (GHC.Types.Int) | k_184 &amp;&amp; k_54[VV#53:=VV#183]}
-&gt; f#a1fa:(lq_tmp_x56:{VV#57 : (GHC.Types.Int) | k_58}
           -&gt; lq_tmp_x59:{VV#183 : (GHC.Types.Int) | k_184 &amp;&amp; k_61[VV#60:=VV#183]}
           -&gt; {VV#183 : (GHC.Types.Int) | k_184 &amp;&amp; k_63[VV#62:=VV#183]})
-&gt; {VV#183 : (GHC.Types.Int) | k_184 &amp;&amp; k_66[VV#65:=VV#183]}</span><span class='hs-varid'>loop</span></a> <a class=annot href="#"><span class=annottext>{VV#181 : (GHC.Types.Int) | (VV#181 == (0  :  int)) &amp;&amp; (VV#181 == lq_anf__d1gw)}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>{VV#168 : (GHC.Types.Int) | (VV#168 == (llen xs#a1fo)) &amp;&amp; (VV#168 == n#a1fq)}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{VV#182 : (GHC.Types.Int) | (VV#182 == (0  :  int)) &amp;&amp; (VV#182 == lq_anf__d1gx)}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>i#a1fr:{VV#169 : (GHC.Types.Int) | k_170}
-&gt; acc#a1fs:{VV#172 : (GHC.Types.Int) | k_173}
-&gt; {VV#175 : (GHC.Types.Int) | k_176}</span><span class='hs-varid'>body</span></a> 
<span class=hs-linenum>86: </span>  <span class='hs-keyword'>where</span> <a class=annot href="#"><span class=annottext>i#a1fr:{VV#169 : (GHC.Types.Int) | k_170}
-&gt; acc#a1fs:{VV#172 : (GHC.Types.Int) | k_173}
-&gt; {VV#175 : (GHC.Types.Int) | k_176}</span><span class='hs-varid'>body</span></a>   <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#169 : (GHC.Types.Int) | k_170}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{VV#172 : (GHC.Types.Int) | k_173}</span><span class='hs-varid'>acc</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{VV#172 : (GHC.Types.Int) | k_173 &amp;&amp; (VV#172 == acc#a1fs)}</span><span class='hs-varid'>acc</span></a> <a class=annot href="#"><span class=annottext>x:(GHC.Types.Int)
-&gt; y:(GHC.Types.Int) -&gt; {VV : (GHC.Types.Int) | (VV == (x + y))}</span><span class='hs-varop'>+</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV#165 : (SimpleRefinements.L {VV : (GHC.Types.Int) | ((VV mod 2) == 0)}) | (VV#165 == xs#a1fo)}</span><span class='hs-varid'>xs</span></a> <a class=annot href="#"><span class=annottext>ls:(SimpleRefinements.L {VV#177 : (GHC.Types.Int) | k_178})
-&gt; lq_tmp_db3:{VV : (GHC.Types.Int) | (VV &gt;= 0) &amp;&amp; true}
-&gt; {VV#177 : (GHC.Types.Int) | k_178}</span><span class='hs-varop'>!!</span></a> <a class=annot href="#"><span class=annottext>{VV#169 : (GHC.Types.Int) | k_170 &amp;&amp; (VV#169 == i#a1fr)}</span><span class='hs-varid'>i</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>87: </span>        <a class=annot href="#"><span class=annottext>{VV : (GHC.Types.Int) | (VV == (llen xs#a1fo))}</span><span class='hs-varid'>n</span></a>      <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>xs:(SimpleRefinements.L {VV#166 : (GHC.Types.Int) | k_167})
-&gt; {VV : (GHC.Types.Int) | (VV == (llen xs))}</span><span class='hs-varid'>length</span></a> <a class=annot href="#"><span class=annottext>{VV#165 : (SimpleRefinements.L {VV : (GHC.Types.Int) | ((VV mod 2) == 0)}) | (VV#165 == xs#a1fo)}</span><span class='hs-varid'>xs</span></a>
</pre>

<p>Here, the system deduces that <code>(+)</code> has type</p>
<ul>
<li><code>x:Int-&gt; y:Int -&gt; {v:Int| v=x+y} &lt;: Even -&gt; Even -&gt; Even</code></li>
</ul>
<p>Hence, verification proceeds by <em>instantiating</em> <code>a</code> with <code>Even</code></p>
<ul>
<li><code>loop :: Int -&gt; Int -&gt; Even -&gt; (Int -&gt; Even -&gt; Even) -&gt; Even</code></li>
</ul>
<h2 id="another-example">Another Example</h2>
<p>Consider a simpler example:<br></p>
<pre><span class=hs-linenum>106: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>add</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>Int</span><span class='hs-keyword'>| v = m + n}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>107: </span><span class='hs-definition'>add</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>108: </span><a class=annot href="#"><span class=annottext>n:{VV : (GHC.Types.Int) | (VV &gt;= 0)}
-&gt; m:{VV : (GHC.Types.Int) | (VV &gt;= 0)}
-&gt; {VV : (GHC.Types.Int) | (VV == (m + n))}</span><span class='hs-definition'>add</span></a> <a class=annot href="#"><span class=annottext>{VV : (GHC.Types.Int) | (VV &gt;= 0)}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{VV : (GHC.Types.Int) | (VV &gt;= 0)}</span><span class='hs-varid'>m</span></a> <span class='hs-keyglyph'>=</span> <span class=hs-error><a class=annot href="#"><span class=annottext>lo#a1f7:{VV#47 : (GHC.Types.Int) | k_48}
-&gt; hi#a1f8:{VV#50 : (GHC.Types.Int) | k_51}
-&gt; base#a1f9:{VV#198 : (GHC.Types.Int) | k_199 &amp;&amp; k_54[VV#53:=VV#198]}
-&gt; f#a1fa:(lq_tmp_x56:{VV#57 : (GHC.Types.Int) | k_58}
           -&gt; lq_tmp_x59:{VV#198 : (GHC.Types.Int) | k_199 &amp;&amp; k_61[VV#60:=VV#198]}
           -&gt; {VV#198 : (GHC.Types.Int) | k_199 &amp;&amp; k_63[VV#62:=VV#198]})
-&gt; {VV#198 : (GHC.Types.Int) | k_199 &amp;&amp; k_66[VV#65:=VV#198]}</span><span class='hs-varid'>loop</span></a></span><span class=hs-error> </span><span class=hs-error><a class=annot href="#"><span class=annottext>{VV#187 : (GHC.Types.Int) | (VV#187 == (0  :  int)) &amp;&amp; (VV#187 == lq_anf__d1gy)}</span><span class='hs-num'>0</span></a></span><span class=hs-error> </span><span class=hs-error><a class=annot href="#"><span class=annottext>{VV#186 : (GHC.Types.Int) | (VV#186 &gt;= 0) &amp;&amp; (VV#186 == m#a1fu)}</span><span class='hs-varid'>m</span></a></span><span class=hs-error> </span><span class=hs-error><a class=annot href="#"><span class=annottext>{VV#185 : (GHC.Types.Int) | (VV#185 &gt;= 0) &amp;&amp; (VV#185 == n#a1ft)}</span><span class='hs-varid'>n</span></a></span><span class=hs-error> </span><span class=hs-error><span class='hs-layout'>(</span></span><span class=hs-error><a class=annot href="#"><span class=annottext>ds_d1gj:{VV#188 : (GHC.Types.Int) | k_189}
-&gt; i#a1fv:{VV#191 : (GHC.Types.Int) | k_192}
-&gt; {VV#194 : (GHC.Types.Int) | k_195}</span><span class='hs-keyglyph'>\</span></a></span><span class=hs-error><span class='hs-keyword'>_</span></span><span class=hs-error> </span><span class=hs-error><a class=annot href="#"><span class=annottext>{VV#191 : (GHC.Types.Int) | k_192}</span><span class='hs-varid'>i</span></a></span><span class=hs-error> </span><span class=hs-error><span class='hs-keyglyph'>-&gt;</span></span><span class=hs-error> </span><span class=hs-error><a class=annot href="#"><span class=annottext>{VV#191 : (GHC.Types.Int) | k_192 &amp;&amp; (VV#191 == i#a1fv)}</span><span class='hs-varid'>i</span></a></span><span class=hs-error> </span><span class=hs-error><a class=annot href="#"><span class=annottext>x:(GHC.Types.Int)
-&gt; y:(GHC.Types.Int) -&gt; {VV : (GHC.Types.Int) | (VV == (x + y))}</span><span class='hs-varop'>+</span></a></span><span class=hs-error> </span><span class=hs-error><a class=annot href="#"><span class=annottext>{VV#196 : (GHC.Types.Int) | (VV#196 == (1  :  int)) &amp;&amp; (VV#196 == lq_anf__d1gz)}</span><span class='hs-num'>1</span></a></span><span class=hs-error><span class='hs-layout'>)</span></span>
</pre>

<p>Cannot use parametric polymorphism as before!</p>
<ul>
<li>Cannot instantiate <code>a</code> with <code>{v:Int|v = n + m}</code> ...</li>
<li>... as this only holds after <strong>last iteration</strong> of loop!</li>
</ul>
<p>Require Higher Order Invariants</p>
<ul>
<li>On values computed in <strong>intermediate</strong> iterations...</li>
<li>... i.e. invariants that <strong>depend on the iteration index</strong>.</li>
</ul>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>
